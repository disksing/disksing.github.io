---
title: "主干开发模式与功能分支开发模式"
date: 2022-06-22
tags: ["杂谈"]
draft: true
---

本文主要素材取自去年公司内部关于 **主干开发模式（trunk based development）** 和 **功能分支开发模式（feature branch based development）** 的世纪大论战。

当时管理层的意思是为了更好地控制质量，应该引入feature branch，不过这引起了一线开发的剧烈反对意见。轰轰烈烈的大辩论持续了好几天，最后的结果是我们没赢（老板们拍板还是要推feature branch），同时实际上却也没输（feature branch到现在也没真正落地）。

二者孰优孰劣的话题这里也想先简单说一下，网上不少人总结过，我就挑其中两点聊聊我的看法。

其一是**代码冲突**。

有一种观点认为主干开发模式的一大弊端就是所有人都往master上合代码，需要频繁解决代码冲突。不过我觉得feature branch其实并不能减少太多代码冲突量，大体上只是把零散的冲突延迟到合分支的时候批量解决了。（当然了要是较真的话，feature branch的冲突量还是会小一些，因为原本的多次冲突可能会合并或者抵消掉。）

冲突延迟确实有一定好处，但是也很危险：如果冲突不只是“文本冲突”，而是某种“底层模型”层面上的冲突，那么可能需要进行重新设计，这种情况下，越早让冲突发生，我们才能尽早发现问题避免大量返工。

所以对于代码冲突，我觉得看项目的情况。如果说项目里每个人开发的功能互相关联不大，即使有冲突也大都是简单的文本冲突（比如两个功能都往同一个配置文件里加一段），可以机械地resolve，那么适合使用feature branch。反之如果不同分支关联性大，尤其是容易改到相同的底层模块，那就更适合主干开发模式。

另一个是**代码质量**。

很多人觉得主干开发模式下，master频繁更新，甚至开发中的半成品功能都往里面提，质量肯定好不了。

我认为这一点同样跟项目的情况有关。

如果项目主要依靠QA人工测试，用主干开发模式肯定是保证不了质量的，因为QA不可能有足够的人力对大量的小版本进行回归测试，最合理的方式就是使用feature branch，合并到master之前对branch进行详细测试，合并完成后再做详细的回归测试。

如果项目的