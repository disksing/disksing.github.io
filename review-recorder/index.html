<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>追踪 GitHub PR review 记录 - 硬盘在歌唱</title><link rel=icon type=image/png href=favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="使用 chrome 插件追踪 GitHub PR review 记录，并把数据存放在 Google Spreadsheet。"><meta property="og:image" content><meta property="og:title" content="追踪 GitHub PR review 记录"><meta property="og:description" content="使用 chrome 插件追踪 GitHub PR review 记录，并把数据存放在 Google Spreadsheet。"><meta property="og:type" content="article"><meta property="og:url" content="https://disksing.com/review-recorder/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-10-18T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-18T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="追踪 GitHub PR review 记录"><meta name=twitter:description content="使用 chrome 插件追踪 GitHub PR review 记录，并把数据存放在 Google Spreadsheet。"><link href=https://disksing.com/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://disksing.com/css/main.40ca3a860425083862b7ebd55447caec5c4384573f0cb098b8d06a91e8dace2e.css></head><body><div class=content><header><div class=main><a href=https://disksing.com/>硬盘在歌唱</a></div><nav><a href=/>主页</a>
<a href=/post/>文章</a>
<a href=/about/>关于</a></nav></header><main><article><div class=title><h1 class=title>追踪 GitHub PR review 记录</h1><div class=meta>Posted on Oct 18, 2019</div></div><section class=body><h2 id=为啥要搞这个>为啥要搞这个</h2><p>最近公司项目组推行了一个规定：周报里面要把 Review 过的 PR 填上。作为有尊严的程序员，我们肯定是想自动化地来做。可惜试了下 GitHub 的 API 之后发现有几个蛋疼的问题，主要是如果 review 完了没有 comment 直接 approve 的话查不到记录（其实能，但是会很麻烦）。</p><p>于是我就想搞个 chrome 插件来统计，有个额外的 bonus 是可以（粗略）统计 review 每个 PR 花的时间，当然了最主要的原因是我没写过 chrome 插件，想玩一玩。</p><p>另外一个问题是，我会用多个电脑工作，很自然地需要一个服务器来同步数据，也为了好玩点，我决定把数据给存在 Google Spreadsheet 上。</p><h2 id=怎么做的>怎么做的</h2><p>先说一下 chrome 插件部分，大体上就是判断是 Pull Request 页面后触发一个定时器，每分钟检查一下，如果在 review 就把相关信息 POST 到服务端记条日志。判断在 review 的标准是一分钟内在 /pull/xxx/files 页面有过点击鼠标，或者按键，或者 scroll 操作。另外点击插件 icon 的时候打开一个新 tab 查询 review 统计信息，默认查最近一周的记录（包含当天）。</p><p>Spreadsheet 这边就是一空白的表格加两段 Google App Script。<code>doPost</code> 负责接收 review 记录，记在表格里。<code>doGet</code> 负责汇总一段时间内的记录。</p><h2 id=手把手安装教程>手把手安装教程</h2><p>这个步骤略麻烦，坦率地讲并不是真推荐给你用，更多地是展示一下怎么把 chrome extension + app script + spread sheet 这套前端+后端+数据库的技术栈给跑起来。</p><p>首先是数据库，用 <a href=https://docs.google.com/spreadsheets/d/12w6E9IZsLP58mYbqjE-cOaVtIx--UIocuGM_MihIWdI/copy>这个链接</a> 创建一份 SpreadSheet 副本即可，标题可以随便改一个你认为合适的名字。</p><p>然后，打开“脚本编辑器”。</p><p><img src=/assets/img/recorder-script-editor.png alt=script-editor></p><p>你会在新的页面里看到我预先写好的 App Script，也就是服务器端的代码啦。不关心的话就不用管代码，直接发布成网络应用。</p><p><img src=/assets/img/recorder-publish.png alt=publish></p><p>注意，“项目版本”选“新建”，“有权使用该应用的人”选择“任何人（甚至匿名）”。</p><p><img src=/assets/img/recorder-deploy.png alt=deploy></p><p>这时不出意外的话会提示需要授权 app 访问表格，依照提示操作即可。注意下图这里需要先点“高级”，然后“转到 recorder server（不安全）”，最后选择“允许”进行授权。</p><p><img src=/assets/img/recorder-auth.png alt=auth></p><p>一顿操作之后就会看到已部署为网络应用的提示，这就说明服务端已经完成啦，我们把应用的网址拷贝下来备用。</p><p><img src=/assets/img/recorder-deploy-ok.png alt=deploy-ok></p><p>接着是客户端，也就是 chrome 插件的部分了。你需要把 <a href=https://github.com/disksing/review-recorder>GitHub 项目</a> clone 或下载到本地。编辑 <code>chrome-extension/config.js</code> 文件，把 SCRIPT_APP_URL 改成刚才复制的 URL，把 IGNORE_AUTHOR_ID 改成你自己的 GitHub ID（这个是为了防止自己的 PR 被记录），RECORD_INTERVAL 是上报的间隔一般不用改。</p><p><img src=/assets/img/recorder-config.png alt=config></p><p>最后一步，安装插件。打开插件页面(地址栏输入 chrome://extensions)，点击“加载已解压的扩展程序”，选择 <code>chrome-extension</code> 目录进行安装，成功后如图。</p><p><img src=/assets/img/recorder-extension.png alt=extension></p><p>这样就完成了，PR review 历史会被自动记录在 SpreadSheet 里，点击插件的图标可以看到最近一周的统计。</p><h2 id=总结一下>总结一下</h2><p>这个套玩意儿亲测好用，我已经跑了一周了，下面是我这边统计的结果和一周汇总，看起来<del>极大地</del>解放了生产力。</p><p><img src=/assets/img/recorder-data.png alt=data></p><p><img src=/assets/img/recorder-weekly.png alt=weekly></p><p>其实还是有不少问题的，比如1分钟的间隔可能有些长，容易统计漏，还有时不时去看一些很老的 PR 时也会被记录在案。当然了我主要性质是玩票，也就不在意这些细节了。</p><p>通过这次尝试，我发现 Google App script 这一套可玩性还是很高的。毕竟 G suite 集邮件，文档，表格，演示文稿，网盘，日程，任务管理，甚至调查问卷等等等等于一体，App Script 提供了丰富强大的 API，使用应用之间可以互联互通，你还可以创建简单 Json API server 或是 HTTP server。最关键的是这些还全都不要钱。</p><p>最大的问题可能就是慢了，只适合处理低频小数据。我感觉可能适合通过 IFTTT 等工具把个人数据给灌进 spreadsheet，然后搞一些后台脚本跟 G suite 发生互动，还可以接 Google chart 做成 metrics 进行分析啥的，有时间可以试试。</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/%E6%95%99%E7%A8%8B>教程</a></li><li><a href=/tags/app-script>App Script</a></li></ul></nav></div></article></main><footer><div style=display:flex></div><div class=footer-info>2022 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-154774927-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>