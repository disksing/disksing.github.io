<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>追踪 GitHub PR review 记录</title>
<link rel=icon href=http://disksing.com/favicon.png><style>:root{--accent:red;--border-width:5px}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-tc-webfont@1.0.0/style.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link rel=stylesheet href=/css/main.css><style>body{font-family:sans-serif}pre,code{font-family:lxgw wenkai mono,sans-serif}</style><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script>$(document).on("click",function(){$(".collapse").collapse("hide")})</script><meta name=generator content="Hugo 0.121.1"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-154774927-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-154774927-1")</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script data-ad-client=ca-pub-8963356574249468 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>追踪 GitHub PR review 记录</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>主页</a></li><li><a href=/post/>文章</a></li><li><a href=/tip/>知识点</a></li><li><a href=/project/>开源项目</a></li><li><a href=/story/>故事</a></li><li><a href=/about/>关于</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=mailto:i@disksing.com><i class="fa fa-envelope-o"></i></a></li><li class=navbar-icon><a href=https://github.com/disksing/><i class="fa fa-github"></i></a></li><li class=navbar-icon><a href=http://weibo.com/539523448><i class="fa fa-weibo"></i></a></li><li class=navbar-icon><a href="http://shang.qq.com/wpa/qunwpa?idkey=ade2895067e4105ce59e0c56863d650543b4448245f179574c6684fe1cb7b5d5"><i class="fa fa-qq"></i></a></li><li class=navbar-icon><a href=https://space.bilibili.com/2207710><i class="fa fa-tv"></i></a></li><li class=navbar-icon><a href=https://twitter.com/disksing/><i class="fa fa-twitter"></i></a></li></ul></div></div></nav><main><div><h1>追踪 GitHub PR review 记录</h1><h5>2019-10-18</h5><a href=http://disksing.com/tags/%E6%95%99%E7%A8%8B><kbd class=item-tag>教程</kbd></a>
<a href=http://disksing.com/tags/app-script><kbd class=item-tag>App Script</kbd></a></div><div align=start class=content><h2 id=为啥要搞这个>为啥要搞这个</h2><p>最近公司项目组推行了一个规定：周报里面要把 Review 过的 PR 填上。作为有尊严的程序员，我们肯定是想自动化地来做。可惜试了下 GitHub 的 API 之后发现有几个蛋疼的问题，主要是如果 review 完了没有 comment 直接 approve 的话查不到记录（其实能，但是会很麻烦）。</p><p>于是我就想搞个 chrome 插件来统计，有个额外的 bonus 是可以（粗略）统计 review 每个 PR 花的时间，当然了最主要的原因是我没写过 chrome 插件，想玩一玩。</p><p>另外一个问题是，我会用多个电脑工作，很自然地需要一个服务器来同步数据，也为了好玩点，我决定把数据给存在 Google Spreadsheet 上。</p><h2 id=怎么做的>怎么做的</h2><p>先说一下 chrome 插件部分，大体上就是判断是 Pull Request 页面后触发一个定时器，每分钟检查一下，如果在 review 就把相关信息 POST 到服务端记条日志。判断在 review 的标准是一分钟内在 /pull/xxx/files 页面有过点击鼠标，或者按键，或者 scroll 操作。另外点击插件 icon 的时候打开一个新 tab 查询 review 统计信息，默认查最近一周的记录（包含当天）。</p><p>Spreadsheet 这边就是一空白的表格加两段 Google App Script。<code>doPost</code> 负责接收 review 记录，记在表格里。<code>doGet</code> 负责汇总一段时间内的记录。</p><h2 id=手把手安装教程>手把手安装教程</h2><p>这个步骤略麻烦，坦率地讲并不是真推荐给你用，更多地是展示一下怎么把 chrome extension + app script + spread sheet 这套前端+后端+数据库的技术栈给跑起来。</p><p>首先是数据库，用 <a href=https://docs.google.com/spreadsheets/d/12w6E9IZsLP58mYbqjE-cOaVtIx--UIocuGM_MihIWdI/copy>这个链接</a> 创建一份 SpreadSheet 副本即可，标题可以随便改一个你认为合适的名字。</p><p>然后，打开“脚本编辑器”。</p><p><img src=/assets/img/recorder-script-editor.png alt=script-editor></p><p>你会在新的页面里看到我预先写好的 App Script，也就是服务器端的代码啦。不关心的话就不用管代码，直接发布成网络应用。</p><p><img src=/assets/img/recorder-publish.png alt=publish></p><p>注意，“项目版本”选“新建”，“有权使用该应用的人”选择“任何人（甚至匿名）”。</p><p><img src=/assets/img/recorder-deploy.png alt=deploy></p><p>这时不出意外的话会提示需要授权 app 访问表格，依照提示操作即可。注意下图这里需要先点“高级”，然后“转到 recorder server（不安全）”，最后选择“允许”进行授权。</p><p><img src=/assets/img/recorder-auth.png alt=auth></p><p>一顿操作之后就会看到已部署为网络应用的提示，这就说明服务端已经完成啦，我们把应用的网址拷贝下来备用。</p><p><img src=/assets/img/recorder-deploy-ok.png alt=deploy-ok></p><p>接着是客户端，也就是 chrome 插件的部分了。你需要把 <a href=https://github.com/disksing/review-recorder>GitHub 项目</a> clone 或下载到本地。编辑 <code>chrome-extension/config.js</code> 文件，把 SCRIPT_APP_URL 改成刚才复制的 URL，把 IGNORE_AUTHOR_ID 改成你自己的 GitHub ID（这个是为了防止自己的 PR 被记录），RECORD_INTERVAL 是上报的间隔一般不用改。</p><p><img src=/assets/img/recorder-config.png alt=config></p><p>最后一步，安装插件。打开插件页面(地址栏输入 chrome://extensions)，点击“加载已解压的扩展程序”，选择 <code>chrome-extension</code> 目录进行安装，成功后如图。</p><p><img src=/assets/img/recorder-extension.png alt=extension></p><p>这样就完成了，PR review 历史会被自动记录在 SpreadSheet 里，点击插件的图标可以看到最近一周的统计。</p><h2 id=总结一下>总结一下</h2><p>这个套玩意儿亲测好用，我已经跑了一周了，下面是我这边统计的结果和一周汇总，看起来<del>极大地</del>解放了生产力。</p><p><img src=/assets/img/recorder-data.png alt=data></p><p><img src=/assets/img/recorder-weekly.png alt=weekly></p><p>其实还是有不少问题的，比如1分钟的间隔可能有些长，容易统计漏，还有时不时去看一些很老的 PR 时也会被记录在案。当然了我主要性质是玩票，也就不在意这些细节了。</p><p>通过这次尝试，我发现 Google App script 这一套可玩性还是很高的。毕竟 G suite 集邮件，文档，表格，演示文稿，网盘，日程，任务管理，甚至调查问卷等等等等于一体，App Script 提供了丰富强大的 API，使用应用之间可以互联互通，你还可以创建简单 Json API server 或是 HTTP server。最关键的是这些还全都不要钱。</p><p>最大的问题可能就是慢了，只适合处理低频小数据。我感觉可能适合通过 IFTTT 等工具把个人数据给灌进 spreadsheet，然后搞一些后台脚本跟 G suite 发生互动，还可以接 Google chart 做成 metrics 进行分析啥的，有时间可以试试。</p></div><hr><b>欢迎加入技术讨论 QQ 群： </b>745157974<h4 class=page-header>Related</h4><div class=item><h4><a href=/desktop-layout/>适合程序员的桌面窗口管理方案</a></h4><h5>2022-03-15</h5><a href=http://disksing.com/tags/%E6%95%99%E7%A8%8B><kbd class=item-tag>教程</kbd></a></div><div class=item><h4><a href=/tag-github-gmail/>自动给 Gmail 中 GitHub 的邮件打标签</a></h4><h5>2020-01-15</h5><a href=http://disksing.com/tags/%E6%95%99%E7%A8%8B><kbd class=item-tag>教程</kbd></a>
<a href=http://disksing.com/tags/app-script><kbd class=item-tag>App Script</kbd></a></div><div class=item><h4><a href=/docker-seafile/>使用 Docker+Seafile 搭建私有云存储</a></h4><h5>2015-05-10</h5><a href=http://disksing.com/tags/%E6%95%99%E7%A8%8B><kbd class=item-tag>教程</kbd></a></div></main><footer></footer><p class="copyright text-muted">&copy; 2014-2023 ALL RIGHTS RESERVED
|
本站由 <a href=https://gohugo.io>Hugo</a> 和 <a href=https://github.com/calintat/minimal>Minimal</a> 强力驱动
|
<a href=http://disksing.com/post/index.xml target=_blank><i class="fa fa-rss-square"></i>订阅本站文章</a> <a href=http://github.com/disksing/disksing.github.io/issues/new target=_blank><i class="fa fa-bug"></i>反馈问题</a><br>若无特别说明，本站文章采用 <a rel=license href=http://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a> 进行许可，文中涉及代码采用 <a rel=license href=http://creativecommons.org/publicdomain/zero/1.0/>CC0 1.0 Universal</a> 进行许可</p><script>MathJax={tex:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script></body></html>